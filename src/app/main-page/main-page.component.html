<div class="container">
    <div class="account-management">
        <div 
            class="widget" 
            appWidget 
            [widgetHeight]="'150px'"
            [widgetWidth]="'150px'"
        >
            <img [src]="
                !previewMode 
                    ?(
                        activeProfile.role === 'admin' ? '../assets/icons/admin-icon.png' 
                        : '../assets/icons/user-icon.png'
                    )
                    : (
                        previewedProfile.role === 'admin' ? '../assets/icons/admin-icon.png' 
                        : '../assets/icons/user-icon.png'
                    )
            ">
        </div>
        <div class="account-info">
            <div class="account-name">
                <h1>
                    {{ 
                        !previewMode ? activeProfile.name
                        : previewedProfile.name 
                    }}
                </h1>
                <a *ngIf="activeProfile.role === 'admin'" (click)="onEnterPreviewMode(modalRef)">
                    <img src="../assets/icons/swap-icon.png" width="35px">
                </a>
            </div>
            <div class="options" *ngIf="!previewMode">
                <a 
                    style="cursor: pointer;" 
                    *ngIf="activeProfile?.PIN !== null && activeProfile?.role === 'admin'"
                    (click)="onAddProfile()"
                >
                    Dodaj profil
                </a>
                <a style="cursor: pointer;" (click)="onSettings()">Ustawienia</a>
                <a style="cursor: pointer;">Powiadomienia</a>
                <a style="cursor: pointer;" (click)="onLogout()">Wyloguj się</a>
                <p
                    style="color: red;"
                    *ngIf="activeProfile?.PIN === null && activeProfile?.role === 'admin'"
                >
                    Ustaw kod PIN dla swojego profilu, żeby móc dodawać nowe profile!
                </p>
            </div>
            <p *ngIf="previewMode">
                Zalogowano jako: {{ activeProfile.name }}
            </p>
        </div>
    </div>
    <div class="text-form">
        <div class="change-month">
            <a (click)="onStepBackMonth()" style="cursor: pointer;"> < </a>
            <p> {{ checkedMonth + ' ' + checkedDate.getFullYear()}} </p>
            <a (click)="onMoveForwardMonth()" style="cursor: pointer;"> > </a>
        </div>
        <div 
            class="widget"
            appWidget
            widgetHeight="150px"
            widgetWidth="70%"
        >
            <p>Wydatki w: {{ checkedMonth + ' ' + checkedDate.getFullYear()}}</p>
            <h1>{{ monthlySum }} zł</h1>
        </div>

    </div>
    <div class="box">
        <div class="addBtn" [ngStyle]="{visibility: previewMode ? 'hidden' : 'visible'}">
            <button appButtonDir (click)="onAddExpense()">Dodaj wydatek</button>
        </div>
        <div class="graph">
            <div 
                class="widget"
                appWidget
                widgetHeight="330px"
                widgetWidth="100%"
            >
                <p class="no-expenses-info" *ngIf="monthlyExpenses.length === 0">
                    Brak wydatków.
                </p>
                <canvas 
                    id="chart" 
                    [ngStyle]="{ 
                        visibility: monthlyExpenses.length === 0 ? 'hidden' : 'visible' 
                    }"
                ></canvas>
                <div class="chart-display">
                    <p (click)="onCategoryChart()"> <- </p>
                    <p (click)="onDaysInMonthChart()"> -> </p>
                </div>
            </div>
        </div>
    </div>
    <div class="last-expenses-list">
        <div 
            class="widget"
            appWidget
            [widgetHeight]="'35vh'"
            [widgetWidth]="'100%'"
        >
            <p>Ostatnie wydatki</p>
            <div class="scroll">
                <p class="no-expenses-info" *ngIf="monthlyExpenses.length === 0">
                    Brak wydatków.
                </p>
                <table>
                    <tr *ngFor="let expense of monthlyExpenses">
                        <td>{{ 
                            previewMode ? previewedProfile.categories?.find(findCategory(expense))?.content 
                            : activeProfile.categories?.find(findCategory(expense))?.content 
                        }}</td>
                        <td>{{ expense.price + ' zł' }}</td>
                        <td>{{ expense.date | date}}</td>
                        <td>{{ expense.description }}</td>
                        <td>{{ expense.renewalTime ? expense.renewalTime + ' dni' : '-' }}</td>
                    </tr>
                </table>
            </div>
        </div>
</div>

<ng-template #modalRef>
    <div class="modal-container">
        <div class="modal-row">
            <h1>Wybierz profil do podglądu:</h1>
            <div class="button">
                <button (click)="onCloseModal()">
                    <img src="../assets/icons/cancel.png">
                </button>
            </div>
        </div>
        <div class="modal-content">
            <div 
                class="item" 
                *ngFor="let profile of loggedUser?.profiles"
                [ngClass]="{
                    active: (previewMode === false && profile.id === activeProfile.id) || (previewMode === true && profile.id === previewedProfile.id)
                }"
                (click)="onSelectProfile(profile)"
            >
                <div 
                    class="widget"
                    appWidget
                    widgetHeight="150px"
                    widgetWidth="150px"
                >
                    <img [src]="
                        profile.role === 'admin' ? '../assets/icons/admin-icon.png'
                        : '../assets/icons/user-icon.png'
                    ">
                </div>
                <p>{{ profile.name }}</p>
            </div>
        </div>
    </div>
</ng-template>